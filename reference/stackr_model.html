<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><meta name="description" content="Provides a wrapper for different EpiSoon model wrappers and generates
a mixture model of these models based on the (Continuous) Rank Probability
Score
A list of models is supplied. These models are fit to the data up until a
period of observations of size weighting_period. Forecasts are generated
from all the models for all time points in the weighting_period.
Predictive samples generated by the individual models are then used to
create model weights in an ensemble based on CRPS. All models are then
refitted for the entire timeseries and predictions are generated from these
models. Draws from the individual model predictive samples are then used
to generate a mixture model with the weights obtained in the previous step.
The weights are computed using crps_weights from
the package stackr to minimise CRPS. The function
mixture_from_samples from the same package is used
to draw samples from the
individual models to form the mixture models."><title>Stack Models According to CRPS — stackr_model • EpiSoon</title><script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><link href="../deps/bootstrap-5.2.2/bootstrap.min.css" rel="stylesheet"><script src="../deps/bootstrap-5.2.2/bootstrap.bundle.min.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous"><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous"><!-- bootstrap-toc --><script src="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@v1.0.1/dist/bootstrap-toc.min.js" integrity="sha256-4veVQbu7//Lk5TSmc7YV48MxtMy98e26cf5MrgZYnwo=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- search --><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Stack Models According to CRPS — stackr_model"><meta property="og:description" content="Provides a wrapper for different EpiSoon model wrappers and generates
a mixture model of these models based on the (Continuous) Rank Probability
Score
A list of models is supplied. These models are fit to the data up until a
period of observations of size weighting_period. Forecasts are generated
from all the models for all time points in the weighting_period.
Predictive samples generated by the individual models are then used to
create model weights in an ensemble based on CRPS. All models are then
refitted for the entire timeseries and predictions are generated from these
models. Draws from the individual model predictive samples are then used
to generate a mixture model with the weights obtained in the previous step.
The weights are computed using crps_weights from
the package stackr to minimise CRPS. The function
mixture_from_samples from the same package is used
to draw samples from the
individual models to form the mixture models."><meta name="twitter:card" content="summary_large_image"><meta name="twitter:creator" content="@seabbs"><meta name="twitter:site" content="@epiforecasts"><!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]--></head><body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>
    

    <nav class="navbar fixed-top navbar-light navbar-expand-lg bg-light"><div class="container">
    
    <a class="navbar-brand me-2" href="../index.html">EpiSoon</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="Released version">0.3.1</small>

    
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto"><li class="active nav-item">
  <a class="nav-link" href="../reference/index.html">Reference</a>
</li>
<li class="nav-item dropdown">
  <a href="#" class="nav-link dropdown-toggle" data-bs-toggle="dropdown" role="button" aria-expanded="false" aria-haspopup="true" id="dropdown-articles">Articles</a>
  <div class="dropdown-menu" aria-labelledby="dropdown-articles">
    <a class="dropdown-item" href="../articles/introduction.html">Getting started</a>
  </div>
</li>
<li class="nav-item">
  <a class="nav-link" href="../news/index.html">Changelog</a>
</li>
      </ul><form class="form-inline my-2 my-lg-0" role="search">
        <input type="search" class="form-control me-sm-2" aria-label="Toggle navigation" name="search-input" data-search-index="../search.json" id="search-input" placeholder="Search for" autocomplete="off"></form>

      <ul class="navbar-nav"></ul></div>

    
  </div>
</nav><div class="container template-reference-topic">
<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="" class="logo" alt=""><h1>Stack Models According to CRPS</h1>
      
      <div class="d-none name"><code>stackr_model.Rd</code></div>
    </div>

    <div class="ref-description section level2">
    <p>Provides a wrapper for different EpiSoon model wrappers and generates
a mixture model of these models based on the (Continuous) Rank Probability
Score</p>
<p>A list of models is supplied. These models are fit to the data up until a
period of observations of size <code>weighting_period</code>. Forecasts are generated
from all the models for all time points in the <code>weighting_period</code>.
Predictive samples generated by the individual models are then used to
create model weights in an ensemble based on CRPS. All models are then
refitted for the entire timeseries and predictions are generated from these
models. Draws from the individual model predictive samples are then used
to generate a mixture model with the weights obtained in the previous step.</p>
<p>The weights are computed using <code><a href="https://rdrr.io/pkg/stackr/man/crps_weights.html" class="external-link">crps_weights</a></code> from
the package <code>stackr</code> to minimise CRPS. The function
<code><a href="https://rdrr.io/pkg/stackr/man/mixture_from_samples.html" class="external-link">mixture_from_samples</a></code> from the same package is used
to draw samples from the
individual models to form the mixture models.</p>
    </div>

    <div class="section level2">
    <h2 id="ref-usage">Usage<a class="anchor" aria-label="anchor" href="#ref-usage"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span><span class="fu">stackr_model</span><span class="op">(</span></span>
<span>  y <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  models <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  samples <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  horizon <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  weighting_period <span class="op">=</span> <span class="fl">5</span>,</span>
<span>  verbose <span class="op">=</span> <span class="cn">TRUE</span></span>
<span><span class="op">)</span></span></code></pre></div>
    </div>

    <div class="section level2">
    <h2 id="arguments">Arguments<a class="anchor" aria-label="anchor" href="#arguments"></a></h2>
    <dl><dt>y</dt>
<dd><p>Numeric vector of time points to forecast</p></dd>


<dt>models</dt>
<dd><p>A list of models. Models must be analogous to the form
<code>function(...){EpiSoon::fable_model(model = , ...)}</code> or
<code>function(...){EpiSoon::bsts_model(model = , ...)}</code>.</p></dd>


<dt>samples</dt>
<dd><p>Numeric, number of samples to take.</p></dd>


<dt>horizon</dt>
<dd><p>Numeric, the time horizon over which to predict.</p></dd>


<dt>weighting_period</dt>
<dd><p>The number of most recent timepoints to hold out to
generate the weights for the mixture model</p></dd>


<dt>verbose</dt>
<dd><p>if TRUE, gives a message if number of observations is too
small to do crps weighting</p></dd>

</dl></div>
    <div class="section level2">
    <h2 id="value">Value<a class="anchor" aria-label="anchor" href="#value"></a></h2>
    

<p>A dataframe of predictions (with columns representing the
time horizon and rows representing samples).</p>
    </div>

    <div class="section level2">
    <h2 id="ref-examples">Examples<a class="anchor" aria-label="anchor" href="#ref-examples"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span class="r-in"><span><span class="kw">if</span> <span class="op">(</span><span class="cn">FALSE</span><span class="op">)</span> <span class="op">{</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># make list with models</span></span></span>
<span class="r-in"><span><span class="va">models</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span></span>
<span class="r-in"><span>  <span class="st">"ARIMA"</span> <span class="op">=</span> <span class="kw">function</span><span class="op">(</span><span class="va">...</span><span class="op">)</span> <span class="op">{</span></span></span>
<span class="r-in"><span>    <span class="fu">EpiSoon</span><span class="fu">::</span><span class="fu"><a href="fable_model.html">fable_model</a></span><span class="op">(</span>model <span class="op">=</span> <span class="fu">fable</span><span class="fu">::</span><span class="fu"><a href="https://fable.tidyverts.org/reference/ARIMA.html" class="external-link">ARIMA</a></span><span class="op">(</span><span class="va">y</span><span class="op">)</span>, <span class="va">...</span><span class="op">)</span></span></span>
<span class="r-in"><span>  <span class="op">}</span>,</span></span>
<span class="r-in"><span>  <span class="st">"ETS"</span> <span class="op">=</span> <span class="kw">function</span><span class="op">(</span><span class="va">...</span><span class="op">)</span> <span class="op">{</span></span></span>
<span class="r-in"><span>    <span class="fu">EpiSoon</span><span class="fu">::</span><span class="fu"><a href="fable_model.html">fable_model</a></span><span class="op">(</span>model <span class="op">=</span> <span class="fu">fable</span><span class="fu">::</span><span class="fu"><a href="https://fable.tidyverts.org/reference/ETS.html" class="external-link">ETS</a></span><span class="op">(</span><span class="va">y</span><span class="op">)</span>, <span class="va">...</span><span class="op">)</span></span></span>
<span class="r-in"><span>  <span class="op">}</span>,</span></span>
<span class="r-in"><span>  <span class="st">"Drift"</span> <span class="op">=</span> <span class="kw">function</span><span class="op">(</span><span class="va">...</span><span class="op">)</span> <span class="op">{</span></span></span>
<span class="r-in"><span>    <span class="fu">EpiSoon</span><span class="fu">::</span><span class="fu"><a href="fable_model.html">fable_model</a></span><span class="op">(</span>model <span class="op">=</span> <span class="fu">fable</span><span class="fu">::</span><span class="fu"><a href="https://fable.tidyverts.org/reference/RW.html" class="external-link">RW</a></span><span class="op">(</span><span class="va">y</span> <span class="op">~</span> <span class="fu">drift</span><span class="op">(</span><span class="op">)</span><span class="op">)</span>, <span class="va">...</span><span class="op">)</span></span></span>
<span class="r-in"><span>  <span class="op">}</span></span></span>
<span class="r-in"><span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># make forecast on its own</span></span></span>
<span class="r-in"><span><span class="va">forecast</span> <span class="op">&lt;-</span> <span class="fu">stackr_model</span><span class="op">(</span></span></span>
<span class="r-in"><span>  y <span class="op">=</span> <span class="fu">EpiSoon</span><span class="fu">::</span><span class="va"><a href="example_obs_rts.html">example_obs_rts</a></span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="fl">10</span>, <span class="op">]</span><span class="op">$</span><span class="va">rt</span>,</span></span>
<span class="r-in"><span>  models <span class="op">=</span> <span class="va">models</span>,</span></span>
<span class="r-in"><span>  samples <span class="op">=</span> <span class="fl">10</span>,</span></span>
<span class="r-in"><span>  horizon <span class="op">=</span> <span class="fl">7</span>,</span></span>
<span class="r-in"><span>  weighting_period <span class="op">=</span> <span class="fl">5</span></span></span>
<span class="r-in"><span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># together with forecast_rt</span></span></span>
<span class="r-in"><span><span class="va">fc_rt</span> <span class="op">&lt;-</span> <span class="fu"><a href="forecast_rt.html">forecast_rt</a></span><span class="op">(</span><span class="fu">EpiSoon</span><span class="fu">::</span><span class="va"><a href="example_obs_rts.html">example_obs_rts</a></span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="fl">10</span>, <span class="op">]</span>,</span></span>
<span class="r-in"><span>  model <span class="op">=</span> <span class="kw">function</span><span class="op">(</span><span class="va">...</span><span class="op">)</span> <span class="op">{</span></span></span>
<span class="r-in"><span>    <span class="fu">stackr_model</span><span class="op">(</span></span></span>
<span class="r-in"><span>      models <span class="op">=</span> <span class="va">models</span>,</span></span>
<span class="r-in"><span>      weighting_period <span class="op">=</span> <span class="fl">5</span>,</span></span>
<span class="r-in"><span>      <span class="va">...</span></span></span>
<span class="r-in"><span>    <span class="op">)</span></span></span>
<span class="r-in"><span>  <span class="op">}</span>,</span></span>
<span class="r-in"><span>  samples <span class="op">=</span> <span class="fl">10</span>,</span></span>
<span class="r-in"><span>  horizon <span class="op">=</span> <span class="fl">7</span></span></span>
<span class="r-in"><span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="va">forecast_eval</span> <span class="op">&lt;-</span> <span class="fu"><a href="evaluate_model.html">evaluate_model</a></span><span class="op">(</span><span class="fu">EpiSoon</span><span class="fu">::</span><span class="va"><a href="example_obs_rts.html">example_obs_rts</a></span>,</span></span>
<span class="r-in"><span>  <span class="fu">EpiSoon</span><span class="fu">::</span><span class="va"><a href="example_obs_cases.html">example_obs_cases</a></span>,</span></span>
<span class="r-in"><span>  model <span class="op">=</span> <span class="kw">function</span><span class="op">(</span><span class="va">...</span><span class="op">)</span> <span class="op">{</span></span></span>
<span class="r-in"><span>    <span class="fu">stackr_model</span><span class="op">(</span></span></span>
<span class="r-in"><span>      models <span class="op">=</span> <span class="va">models</span>,</span></span>
<span class="r-in"><span>      weighting_period <span class="op">=</span> <span class="fl">5</span>,</span></span>
<span class="r-in"><span>      <span class="va">...</span></span></span>
<span class="r-in"><span>    <span class="op">)</span></span></span>
<span class="r-in"><span>  <span class="op">}</span>,</span></span>
<span class="r-in"><span>  horizon <span class="op">=</span> <span class="fl">7</span>, samples <span class="op">=</span> <span class="fl">10</span>,</span></span>
<span class="r-in"><span>  serial_interval <span class="op">=</span> <span class="va">example_serial_interval</span>,</span></span>
<span class="r-in"><span>  min_points <span class="op">=</span> <span class="fl">10</span></span></span>
<span class="r-in"><span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="fu"><a href="plot_forecast_evaluation.html">plot_forecast_evaluation</a></span><span class="op">(</span><span class="va">forecast_eval</span><span class="op">$</span><span class="va">forecast_rts</span>,</span></span>
<span class="r-in"><span>  <span class="fu">EpiSoon</span><span class="fu">::</span><span class="va"><a href="example_obs_rts.html">example_obs_rts</a></span>,</span></span>
<span class="r-in"><span>  horizon_to_plot <span class="op">=</span> <span class="fl">7</span></span></span>
<span class="r-in"><span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="op">}</span></span></span>
<span class="r-in"><span></span></span>
</code></pre></div>
    </div>
  </main><aside class="col-md-3"><nav id="toc"><h2>On this page</h2>
    </nav></aside></div>


    <footer><div class="pkgdown-footer-left">
  <p></p><p>Developed by <a href="https://www.samabbott.co.uk/" class="external-link">Sam Abbott</a>, Nikos Bosse, Joel Hellewell, Katharine Sherratt, James Munday, Robin Thompson, Aurelien Chateigner, Sylvain Mareschal, Andrea Rau, Nathalie Vialaneix, Michael DeWitt, <a href="https://www.lshtm.ac.uk/aboutus/people/funk.sebastian" class="external-link">Sebastian Funk</a>.</p>
</div>

<div class="pkgdown-footer-right">
  <p></p><p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.7.</p>
</div>

    </footer></div>

  

  

  </body></html>

